{% comment %}
  Custom favicon, Open Graph images, and performance optimizations
{% endcomment %}

<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="192x192" href="/assets/favicons/favicon-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/assets/favicons/favicon-512x512.png">
<meta name="theme-color" content="#006aa7">

{%- if page.layout == 'project' -%}
  {%- if page.image -%}
    {%- assign og_image = page.image -%}
  {%- elsif page.featureimage -%}
    {%- assign og_image = '/media' | append: page.permalink | append: '/' | append: page.featureimage -%}
  {%- else -%}
    {%- assign og_image = '/assets/favicons/favicon-512x512.png' -%}
  {%- endif -%}
  <meta property="og:image" content="{{ site.url }}{{ og_image }}">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="{{ site.url }}{{ og_image }}">
{%- else -%}
  <meta property="og:image" content="{{ site.url }}/assets/favicons/favicon-512x512.png">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="{{ site.url }}/assets/favicons/favicon-512x512.png">
{%- endif -%}

<!-- Dark Mode JavaScript - Load early to prevent flash -->
<script>
(function() {
  // Check for saved theme preference or default to light
  const savedTheme = localStorage.getItem('theme');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const theme = savedTheme || (prefersDark ? 'dark' : 'light');

  // Apply theme immediately to prevent flash
  if (theme === 'dark') {
    document.documentElement.setAttribute('data-theme', 'dark');
  }

  // Update theme color meta tag for dark mode
  function updateThemeColor(theme) {
    const themeColorMeta = document.querySelector('meta[name="theme-color"]');
    if (themeColorMeta) {
      themeColorMeta.content = theme === 'dark' ? '#181818' : '#006aa7';
    }
  }

  updateThemeColor(theme);

  // Theme toggle functionality
  function initThemeToggle() {
    const toggleButton = document.getElementById('theme-toggle');
    if (!toggleButton) return;

    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeColor(newTheme);

      // Update button aria-label
      toggleButton.setAttribute('aria-label',
        newTheme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode'
      );
    }

    toggleButton.addEventListener('click', toggleTheme);

    // Set initial aria-label
    toggleButton.setAttribute('aria-label',
      theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode'
    );

    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) {
        const newTheme = e.matches ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', newTheme);
        updateThemeColor(newTheme);
        toggleButton.setAttribute('aria-label',
          newTheme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode'
        );
      }
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initThemeToggle);
  } else {
    initThemeToggle();
  }
})();
</script>
